{
  "title": "Guardrail Unicode Detector v1",
  "uid": "guardrail-unicode-v1",
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timezone": "browser",
  "refresh": "30s",
  "panels": [
    {
      "type": "timeseries",
      "title": "Confusable Ratio (per tenant)",
      "gridPos": {"h": 9, "w": 12, "x": 0, "y": 0},
      "targets": [
        {
          "expr": "avg by (tenant)(unicode_confusable_ratio)",
          "legendFormat": "{{tenant}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "orange", "value": 0.05},
              {"color": "red", "value": 0.08}
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Emoji Ratio (per tenant)",
      "gridPos": {"h": 9, "w": 12, "x": 12, "y": 0},
      "targets": [
        {
          "expr": "avg by (tenant)(unicode_emoji_ratio)",
          "legendFormat": "{{tenant}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "orange", "value": 0.2},
              {"color": "red", "value": 0.25}
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "type": "bargauge",
      "title": "Mixed Script Detections (5m rate)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 9},
      "targets": [
        {
          "expr": "sum(rate(unicode_mixed_script_total[5m])) by (tenant)",
          "legendFormat": "{{tenant}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 2
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "Blocked Requests (last 1h)",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 9},
      "targets": [
        {
          "expr": "sum(increase(unicode_blocked_total[1h])) by (tenant, reason)",
          "legendFormat": "{{tenant}} - {{reason}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "type": "table",
      "title": "Top Paths by Confusable Ratio",
      "gridPos": {"h": 9, "w": 24, "x": 0, "y": 17},
      "targets": [
        {
          "expr": "topk(10, avg_over_time(unicode_confusable_ratio[15m]) by (tenant, path))",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 3
        },
        "overrides": []
      }
    }
  ],
  "templating": {
    "list": []
  },
  "version": 1
}
